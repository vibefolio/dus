<% content_for :title, "디자인 템플릿 - 디어스" %>
<% content_for :description, "성공적인 비즈니스를 위한 최적의 디자인 템플릿을 만나보세요. 원하는 스타일을 선택하고 바로 개발 상담을 받아보실 수 있습니다." %>

<section class="hero" style="min-height: 40vh; padding-top: 120px; background: var(--color-gray-900);">
  <div class="hero-content">
    <h1 class="hero-title" style="font-size: var(--text-5xl);">디자인 템플릿</h1>
    <p class="hero-subtitle" style="font-size: var(--text-xl);">
      검증된 디자인으로 빠르게 시작하세요.<br>
      비즈니스 목적에 맞는 최적의 템플릿을 제안해 드립니다.
    </p>
  </div>
</section>

<section class="section" style="background: var(--color-gray-50);">
  <div class="container">
    
    <!-- Filter (Optional) -->
    <!-- Filter (Scrollable on mobile) -->
    <div style="display: flex; justify-content: center; gap: 8px; margin-bottom: 40px; flex-wrap: wrap;" class="filter-container">
      <button onclick="filterTemplates('all')" class="btn btn-primary btn-sm rounded-full filter-btn active" data-filter="all">전체</button>
      <button onclick="filterTemplates('shopping')" class="btn btn-outline btn-sm rounded-full filter-btn" data-filter="shopping">쇼핑몰</button>
      <button onclick="filterTemplates('corporate')" class="btn btn-outline btn-sm rounded-full filter-btn" data-filter="corporate">기업/브랜드</button>
      <button onclick="filterTemplates('beauty')" class="btn btn-outline btn-sm rounded-full filter-btn" data-filter="beauty">뷰티/살롱</button>
      <button onclick="filterTemplates('dining')" class="btn btn-outline btn-sm rounded-full filter-btn" data-filter="dining">F&B/다이닝</button>
      <button onclick="filterTemplates('space')" class="btn btn-outline btn-sm rounded-full filter-btn" data-filter="space">공간/렌탈</button>
      <button onclick="filterTemplates('medical')" class="btn btn-outline btn-sm rounded-full filter-btn" data-filter="medical">병원/의료</button>
      <button onclick="filterTemplates('stay')" class="btn btn-outline btn-sm rounded-full filter-btn" data-filter="stay">숙박/스테이</button>
    </div>

    <!-- Filter Style -->
    <style>
      .filter-btn {
        background: white;
        border-color: #e5e7eb;
        color: #4b5563;
        transition: all 0.2s;
      }
      .filter-btn:hover {
        background: #f9fafb;
        border-color: #d1d5db;
      }
      .filter-btn.active {
        background: var(--color-primary);
        color: white;
        border-color: var(--color-primary);
      }
    </style>

    <script>
      function filterTemplates(category) {
        // Toggle Buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.classList.remove('active');
          if(btn.dataset.filter === category) {
            btn.classList.add('active');
          }
        });

        // Filter Grid
        const cards = document.querySelectorAll('.template-card');
        cards.forEach(card => {
          if (category === 'all' || card.dataset.category === category) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      }
    </script>

    <!-- Templates Grid -->
    <div class="grid grid-3" style="gap: var(--space-8);" id="templates-grid">
      <% 
        target_templates = [
          { id: 'beauty', title: "LUMIER", desc: "청담동 하이엔드 살롱 스타일. 고급스러운 세리프 폰트.", cat: "beauty", url: "/templates/beauty", img: "https://images.unsplash.com/photo-1595476106812-d2d7237e4585?q=80&w=800" },
          { id: 'dining', title: "溫 (ON)", desc: "여백의 미를 살린 모던 오마카세 다이닝 스타일.", cat: "dining", url: "/templates/dining", img: "https://images.unsplash.com/photo-1590301139475-23eddb51f1f2?q=80&w=800" },
          { id: 'gym', title: "Sculpt & Soul", desc: "아티스틱 웰니스 브랜드 스타일. 감각적인 다크 모드.", cat: "fitness", url: "/templates/gym", img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?q=80&w=800" },
          { id: 'study', title: "Focus Lab", desc: "건축적인 조형미가 돋보이는 스터디 랩 스타일.", cat: "space", url: "/templates/study", img: "https://images.unsplash.com/photo-1497366216548-37526070297c?q=80&w=800" },
          { id: 'stay', title: "서촌 쉼", desc: "한옥의 정취를 담은 감성 스테이. 수평 스크롤.", cat: "stay", url: "/templates/stay", img: "https://images.unsplash.com/photo-1610641818989-c2051b5e2cfd?q=80&w=800" },
          { id: 'corporate', title: "Novus", desc: "신뢰감을 주는 블루톤의 IT 스타트업 스타일.", cat: "corporate", url: "/templates/corporate", img: "https://images.unsplash.com/photo-1460925895917-afdab827c52f?q=80&w=800" },
          { id: 'ecommerce', title: "AETHER", desc: "이미지가 돋보이는 모던 시크 패션 브랜드.", cat: "shopping", url: "/templates/ecommerce", img: "https://images.unsplash.com/photo-1539109136881-3be0616acf4b?q=80&w=800" },
          { id: 'cafe', title: "Daily Crumb", desc: "따뜻한 베이지톤의 감성 베이커리 스타일.", cat: "cafe", url: "/templates/cafe", img: "https://images.unsplash.com/photo-1509440159596-0249088772ff?q=80&w=800" },
          { id: 'portfolio', title: "ARCHIVE", desc: "크리에이터를 위한 다크모드 그리드 갤러리.", cat: "portfolio", url: "/templates/portfolio", img: "https://images.unsplash.com/photo-1600607686527-6fb886090705?q=80&w=800" },
          { id: 'medical', title: "Pure Clinic", desc: "깨끗하고 전문적인 느낌의 클리닉 스타일.", cat: "medical", url: "/templates/medical", img: "https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?q=80&w=800" },
          { id: 'law', title: "Trust & Logic", desc: "세리프 폰트와 네이비 컬러로 무게감을 준 전문직.", cat: "law", url: "/templates/law", img: "https://images.unsplash.com/photo-1589829085413-56de8ae18c73?q=80&w=800" },
          { id: 'wedding', title: "Bliss Moment", desc: "파스텔 톤의 우아하고 로맨틱한 웨딩 페이지.", cat: "wedding", url: "/templates/wedding", img: "https://images.unsplash.com/photo-1519741497674-611481863552?q=80&w=800" }
        ]
      %>

      <% target_templates.each do |t| %>
        <div class="card template-card" data-category="<%= t[:cat] %>" onclick="openTemplateModal('<%= t[:id] %>', '<%= t[:title] %>')" style="cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <div class="card-image-wrapper" style="height: 240px; overflow: hidden; border-radius: var(--radius-lg); position: relative; background: #e5e7eb;">
             <img src="<%= t[:img] %>" class="template-thumb" style="width: 100%; height: 100%; object-fit: cover; object-position: top; transition: transform 0.5s ease;" alt="<%= t[:title] %>">
            
            <div class="template-overlay">
              <span class="btn btn-primary btn-sm">미리보기</span>
            </div>
          </div>
          
          <div style="padding-top: var(--space-4);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-2);">
              <span style="font-size: var(--text-xs); font-weight: 600; color: var(--color-accent); text-transform: uppercase; letter-spacing: 0.05em;">
                <%= t[:cat].upcase %>
              </span>
            </div>
            <h3 style="font-size: var(--text-lg); font-weight: 700; margin-bottom: var(--space-2); color: var(--color-gray-900);">
              <%= t[:title] %>
            </h3>
            <p style="font-size: var(--text-sm); color: var(--color-gray-500); line-height: 1.5; margin-bottom: 0;">
              <%= t[:desc] %>
            </p>
          </div>

          <!-- Hidden Data for Modal -->
          <div id="template-data-<%= t[:id] %>" style="display: none;">
            <div class="data-preview-url"><%= t[:url] %></div>
            <div class="data-title"><%= t[:title] %></div>
            <div class="data-desc"><%= t[:desc] %></div>
            <div class="data-category"><%= t[:cat].upcase %></div>
            <div class="data-img-pc"><%= t[:img] %></div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</section>

<!-- Template Live Demo Modal -->
<div id="template-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: var(--z-modal); opacity: 0; transition: opacity 0.3s ease;">
  <!-- Backdrop -->
  <div onclick="closeTemplateModal()" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);"></div>
  
  <!-- Modal Content -->
  <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); width: 95%; max-width: 1400px; height: 90vh; background: white; border-radius: var(--radius-xl); box-shadow: var(--shadow-2xl); display: flex; flex-direction: column; overflow: hidden; transition: transform 0.3s ease;">
    
    <!-- Modal Header -->
    <div style="padding: var(--space-4) var(--space-6); border-bottom: 1px solid var(--color-gray-200); display: flex; justify-content: space-between; align-items: center; background: white; z-index: 10;">
      <div style="display: flex; align-items: center; gap: 12px;">
        <span id="modal-category" style="font-size: var(--text-xs); color: var(--color-accent); font-weight: 700; text-transform: uppercase; background: #f0fdf4; padding: 4px 8px; border-radius: 4px;">CATEGORY</span>
        <h2 id="modal-title" style="font-size: var(--text-xl); margin: 0; font-weight: 700;">Template Title</h2>
      </div>
      
      <div style="display: flex; align-items: center; gap: var(--space-4);">
        <!-- View Switcher -->
        <div style="background: var(--color-gray-100); padding: 4px; border-radius: var(--radius-full); display: flex;">
          <button onclick="switchView('pc')" id="btn-view-pc" class="view-btn active">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
            <span style="margin-left: 4px;">PC</span>
          </button>
          <button onclick="switchView('mobile')" id="btn-view-mobile" class="view-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12" y2="18"></line></svg>
            <span style="margin-left: 4px;">Mobile</span>
          </button>
        </div>

        <button onclick="closeTemplateModal()" style="background: none; border: none; cursor: pointer; color: var(--color-gray-500); padding: 8px;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>
    </div>

    <!-- Modal Body (Iframe Area) -->
    <div style="flex: 1; overflow: hidden; background: var(--color-gray-100); position: relative; display: flex; justify-content: center; align-items: center; padding: var(--space-6);">
      
      <!-- PC View Frame -->
      <div id="view-pc" style="width: 100%; height: 100%; background: white; box-shadow: var(--shadow-lg); border-radius: var(--radius-sm); overflow: hidden; display: flex; flex-direction: column;">
        <div style="height: 24px; background: #e5e7eb; display: flex; align-items: center; gap: 6px; padding-left: 10px;">
           <div style="width: 8px; height: 8px; border-radius: 50%; background: #ef4444;"></div>
           <div style="width: 8px; height: 8px; border-radius: 50%; background: #f59e0b;"></div>
           <div style="width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></div>
        </div>
        <iframe id="modal-iframe-pc" src="" style="width: 100%; height: 100%; border: none;"></iframe>
      </div>

      <!-- Mobile View Frame -->
      <div id="view-mobile" style="display: none; width: 375px; height: 100%; max-height: 812px; background: black; border-radius: 40px; box-shadow: var(--shadow-2xl); border: 12px solid #1a1a1a; overflow: hidden; position: relative;">
        <!-- Notch -->
        <div style="position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 120px; height: 25px; background: #1a1a1a; border-radius: 0 0 15px 15px; z-index: 10;"></div>
        <iframe id="modal-iframe-mobile" src="" style="width: 100%; height: 100%; border: none; background: white;"></iframe>
      </div>

    </div>

    <!-- Modal Footer -->
    <div style="padding: var(--space-4) var(--space-6); background: white; border-top: 1px solid var(--color-gray-200); display: flex; justify-content: space-between; align-items: center;">
      <p id="modal-desc" style="margin: 0; color: var(--color-gray-600); font-size: var(--text-sm); max-width: 60%;">Template description...</p>
      
      <a id="btn-pick" href="#" class="btn btn-primary btn-lg shine-effect" style="padding-left: var(--space-8); padding-right: var(--space-8);">
        PICK! 이 템플릿으로 의뢰하기
      </a>
    </div>

  </div>
</div>

<style>
  .template-overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .template-card:hover .template-overlay {
    opacity: 1;
  }
  
  .template-card:hover .template-thumb {
    transform: scale(1.05);
  }

  .view-btn {
    border: none;
    background: transparent;
    padding: 6px 12px;
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-gray-500);
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: all 0.2s ease;
  }

  .view-btn.active {
    background: white;
    color: var(--color-primary);
    box-shadow: var(--shadow-sm);
  }

  .shine-effect {
    position: relative;
    overflow: hidden;
  }
  
  .shine-effect::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shine 3s infinite;
  }

  @keyframes shine {
    0% { left: -100%; }
    20% { left: 100%; }
    100% { left: 100%; }
  }
</style>

<script>
  function openTemplateModal(id, title) {
    const modal = document.getElementById('template-modal');
    const content = modal.querySelector('.modal-content');
    const dataContainer = document.getElementById('template-data-' + id);
    
    // Get Data
    const desc = dataContainer.querySelector('.data-desc').innerText;
    const category = dataContainer.querySelector('.data-category').innerText;
    const imgPc = dataContainer.querySelector('.data-img-pc').innerText;
    const imgMobile = dataContainer.querySelector('.data-img-mobile').innerText;

    // Set Data
    document.getElementById('modal-title').innerText = title;
    document.getElementById('modal-desc').innerText = desc;
    document.getElementById('modal-category').innerText = category || 'TEMPLATE';
    
    // Set Preview URL (Live Demo)
    const previewUrl = dataContainer.querySelector('.data-preview-url').innerText.trim();
    const btnPreview = document.getElementById('btn-preview');
    
    if (previewUrl && previewUrl !== "") {
      btnPreview.href = previewUrl;
      btnPreview.style.display = 'inline-flex';
    } else {
      btnPreview.style.display = 'none';
      btnPreview.href = "#";
    }

    // Set Preview URL to Iframes
    const previewUrl = dataContainer.querySelector('.data-preview-url') ? dataContainer.querySelector('.data-preview-url').innerText.trim() : "";
    
    // PC Iframe
    const pcIframe = document.getElementById('modal-iframe-pc');
    const moIframe = document.getElementById('modal-iframe-mobile');

    if (previewUrl && previewUrl !== "") {
      pcIframe.src = previewUrl;
      moIframe.src = previewUrl;
    } else {
      pcIframe.src = 'about:blank';
      moIframe.src = 'about:blank';
    }

    // Set PICK Link
    document.getElementById('btn-pick').href = "/contact?template_id=" + id + "&template_title=" + encodeURIComponent(title);

    // Reset View to PC
    switchView('pc');

    // Show Modal
    modal.style.display = 'block';
    setTimeout(() => {
      modal.style.opacity = '1';
      content.style.transform = 'translate(-50%, -50%) scale(1)';
    }, 10);
    document.body.style.overflow = 'hidden';
  }
  
  // ESC Key Listener for Template Modal
  document.addEventListener('keydown', function(event) {
    const modal = document.getElementById('template-modal');
    if (modal.style.display === 'block') {
      if (event.key === "Escape") {
        closeTemplateModal();
      }
    }
  });

  function closeTemplateModal() {
    const modal = document.getElementById('template-modal');
    const content = modal.querySelector('.modal-content');
    
    modal.style.opacity = '0';
    content.style.transform = 'translate(-50%, -50%) scale(0.95)';
    
    setTimeout(() => {
      modal.style.display = 'none';
      document.body.style.overflow = '';
    }, 300);
  }

  function switchView(mode) {
    const viewPc = document.getElementById('view-pc');
    const viewMobile = document.getElementById('view-mobile');
    const btnPc = document.getElementById('btn-view-pc');
    const btnMobile = document.getElementById('btn-view-mobile');

    if (mode === 'pc') {
      viewPc.style.display = 'block';
      viewMobile.style.display = 'none';
      btnPc.classList.add('active');
      btnMobile.classList.remove('active');
    } else {
      viewPc.style.display = 'none';
      viewMobile.style.display = 'block';
      btnPc.classList.remove('active');
      btnMobile.classList.add('active');
    }
  }
</script>
