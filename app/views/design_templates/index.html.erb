<% content_for :title, "디자인 템플릿 - 디어스" %>
<% content_for :description, "성공적인 비즈니스를 위한 최적의 디자인 템플릿을 만나보세요. 원하는 스타일을 선택하고 바로 개발 상담을 받아보실 수 있습니다." %>

<section class="hero" style="min-height: 40vh; padding-top: 120px; background: var(--color-gray-900);">
  <div class="hero-content">
    <h1 class="hero-title" style="font-size: var(--text-5xl);">디자인 템플릿</h1>
    <p class="hero-subtitle" style="font-size: var(--text-xl);">
      검증된 디자인으로 빠르게 시작하세요.<br>
      비즈니스 목적에 맞는 최적의 템플릿을 제안해 드립니다.
    </p>
  </div>
</section>

<section class="section" style="background: var(--color-gray-50);">
  <div class="container">
    
    <!-- Filter (Optional) -->
    <div style="display: flex; justify-content: center; gap: var(--space-4); margin-bottom: var(--space-12); flex-wrap: wrap;">
      <button class="btn btn-primary btn-sm rounded-full">전체</button>
      <button class="btn btn-outline btn-sm rounded-full" style="background: white; border-color: var(--color-gray-200); color: var(--color-gray-600);">쇼핑몰</button>
      <button class="btn btn-outline btn-sm rounded-full" style="background: white; border-color: var(--color-gray-200); color: var(--color-gray-600);">기업/브랜드</button>
      <button class="btn btn-outline btn-sm rounded-full" style="background: white; border-color: var(--color-gray-200); color: var(--color-gray-600);">랜딩페이지</button>
      <button class="btn btn-outline btn-sm rounded-full" style="background: white; border-color: var(--color-gray-200); color: var(--color-gray-600);">커뮤니티</button>
    </div>

    <!-- Templates Grid -->
    <div class="grid grid-3" style="gap: var(--space-8);">
      <% if @design_templates.any? %>
        <% @design_templates.each do |template| %>
          <div class="card template-card" onclick="openTemplateModal('<%= template.id %>', '<%= template.title %>')" style="cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease;">
            <div class="card-image-wrapper" style="height: 300px; overflow: hidden; border-radius: var(--radius-lg); position: relative; background: #e5e7eb;">
              <% if template.pc_image.attached? %>
                <%= image_tag template.pc_image, class: "template-thumb", style: "width: 100%; height: 100%; object-fit: cover; object-position: top; transition: transform 0.5s ease;" %>
              <% else %>
                <!-- Placeholder Image -->
                <img src="https://picsum.photos/seed/<%= template.id %>/800/600" class="template-thumb" style="width: 100%; height: 100%; object-fit: cover; object-position: top; transition: transform 0.5s ease;" alt="Sample Template">
              <% end %>
              
              <!-- Hover Overlay -->
              <div class="template-overlay">
                <span class="btn btn-primary btn-sm">미리보기</span>
              </div>
            </div>
            
            <div style="padding-top: var(--space-4);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-2);">
                <span style="font-size: var(--text-xs); font-weight: 600; color: var(--color-accent); text-transform: uppercase; letter-spacing: 0.05em;">
                  <%= template.category.presence || "Template" %>
                </span>
              </div>
              <h3 style="font-size: var(--text-xl); font-weight: 700; margin-bottom: var(--space-2); color: var(--color-gray-900);">
                <%= template.title %>
              </h3>
              <p style="font-size: var(--text-sm); color: var(--color-gray-500); line-height: 1.5; margin-bottom: 0;">
                <%= truncate(template.description, length: 60) %>
              </p>
            </div>

            <!-- Hidden Data for Modal -->
            <div id="template-data-<%= template.id %>" style="display: none;">
              <div class="data-title"><%= template.title %></div>
              <div class="data-desc"><%= template.description %></div>
              <div class="data-category"><%= template.category %></div>
              <div class="data-img-pc">
                <%= template.pc_image.attached? ? url_for(template.pc_image) : "https://picsum.photos/seed/#{template.id}/1200/800" %>
              </div>
              <div class="data-img-mobile">
                <%= template.mobile_image.attached? ? url_for(template.mobile_image) : "https://picsum.photos/seed/#{template.id}/375/812" %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <!-- Empty State / Placeholder for Demo (개발 중 보여주기용 12개 더미) -->
        <% 6.times do |i| %>
          <div class="card template-card" style="opacity: 0.6;">
            <div style="height: 300px; background: var(--color-gray-200); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; margin-bottom: var(--space-4);">
              <span style="color: var(--color-gray-500);">Sample Template <%= i + 1 %></span>
            </div>
            <h3 style="font-size: var(--text-xl); margin-bottom: var(--space-2);">준비 중인 템플릿</h3>
            <p style="font-size: var(--text-sm); color: var(--color-gray-500);">곧 더 많은 디자인이 추가될 예정입니다.</p>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</section>

<!-- Template Modal -->
<div id="template-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: var(--z-modal); opacity: 0; transition: opacity 0.3s ease;">
  <!-- Backdrop -->
  <div onclick="closeTemplateModal()" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);"></div>
  
  <!-- Modal Content -->
  <div class="modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); width: 90%; max-width: 1200px; height: 85vh; background: white; border-radius: var(--radius-2xl); box-shadow: var(--shadow-2xl); display: flex; flex-direction: column; overflow: hidden; transition: transform 0.3s ease;">
    
    <!-- Modal Header -->
    <div style="padding: var(--space-4) var(--space-6); border-bottom: 1px solid var(--color-gray-200); display: flex; justify-content: space-between; align-items: center; background: white; z-index: 10;">
      <div>
        <span id="modal-category" style="font-size: var(--text-xs); color: var(--color-accent); font-weight: 700; text-transform: uppercase;">CATEGORY</span>
        <h2 id="modal-title" style="font-size: var(--text-2xl); margin: 0;">Template Title</h2>
      </div>
      
      <div style="display: flex; align-items: center; gap: var(--space-4);">
        <!-- View Switcher -->
        <div style="background: var(--color-gray-100); padding: 4px; border-radius: var(--radius-full); display: flex;">
          <button onclick="switchView('pc')" id="btn-view-pc" class="view-btn active">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
            <span style="margin-left: 4px;">PC</span>
          </button>
          <button onclick="switchView('mobile')" id="btn-view-mobile" class="view-btn">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12" y2="18"></line></svg>
            <span style="margin-left: 4px;">Mobile</span>
          </button>
        </div>

        <button onclick="closeTemplateModal()" style="background: none; border: none; cursor: pointer; color: var(--color-gray-500); padding: 8px;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        </button>
      </div>
    </div>

    <!-- Modal Body (Scrollable) -->
    <div style="flex: 1; overflow-y: auto; background: var(--color-gray-100); position: relative; display: flex; justify-content: center; padding: var(--space-8);">
      
      <!-- PC View Frame -->
      <div id="view-pc" style="width: 100%; max-width: 1000px; background: white; box-shadow: var(--shadow-xl); border-radius: var(--radius-sm); transition: all 0.3s ease;">
        <!-- Browser Bar Mockup -->
        <div style="height: 30px; background: #e5e7eb; border-radius: var(--radius-sm) var(--radius-sm) 0 0; display: flex; align-items: center; padding: 0 12px; gap: 6px;">
          <div style="width: 10px; height: 10px; borderRadius: 50%; background: #ef4444;"></div>
          <div style="width: 10px; height: 10px; borderRadius: 50%; background: #f59e0b;"></div>
          <div style="width: 10px; height: 10px; borderRadius: 50%; background: #10b981;"></div>
        </div>
        <img id="modal-img-pc" src="" style="width: 100%; display: block;" alt="PC Preview">
        <div id="no-img-pc" style="padding: 100px; text-align: center; color: var(--color-gray-400); display: none;">PC 이미지가 없습니다.</div>
      </div>

      <!-- Mobile View Frame -->
      <div id="view-mobile" style="display: none; width: 375px; background: white; border-radius: 40px; box-shadow: var(--shadow-2xl); border: 8px solid #333; overflow: hidden; position: relative;">
        <!-- Notch -->
        <div style="position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 120px; height: 25px; background: #333; border-radius: 0 0 15px 15px; z-index: 10;"></div>
        <img id="modal-img-mobile" src="" style="width: 100%; display: block;" alt="Mobile Preview">
        <div id="no-img-mobile" style="padding: 100px; text-align: center; color: var(--color-gray-400); display: none;">모바일 이미지가 없습니다.</div>
      </div>

    </div>

    <!-- Modal Footer -->
    <div style="padding: var(--space-4) var(--space-6); background: white; border-top: 1px solid var(--color-gray-200); display: flex; justify-content: space-between; align-items: center;">
      <p id="modal-desc" style="margin: 0; color: var(--color-gray-600); font-size: var(--text-sm); max-width: 60%;">Template description goes here.</p>
      
      <a id="btn-pick" href="#" class="btn btn-primary btn-lg shine-effect" style="padding-left: var(--space-8); padding-right: var(--space-8);">
        PICK! 이 템플릿으로 의뢰하기
      </a>
    </div>

  </div>
</div>

<style>
  .template-overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .template-card:hover .template-overlay {
    opacity: 1;
  }
  
  .template-card:hover .template-thumb {
    transform: scale(1.05);
  }

  .view-btn {
    border: none;
    background: transparent;
    padding: 6px 12px;
    border-radius: var(--radius-full);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-gray-500);
    cursor: pointer;
    display: flex;
    align-items: center;
    transition: all 0.2s ease;
  }

  .view-btn.active {
    background: white;
    color: var(--color-primary);
    box-shadow: var(--shadow-sm);
  }

  .shine-effect {
    position: relative;
    overflow: hidden;
  }
  
  .shine-effect::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    animation: shine 3s infinite;
  }

  @keyframes shine {
    0% { left: -100%; }
    20% { left: 100%; }
    100% { left: 100%; }
  }
</style>

<script>
  function openTemplateModal(id, title) {
    const modal = document.getElementById('template-modal');
    const content = modal.querySelector('.modal-content');
    const dataContainer = document.getElementById('template-data-' + id);
    
    // Get Data
    const desc = dataContainer.querySelector('.data-desc').innerText;
    const category = dataContainer.querySelector('.data-category').innerText;
    const imgPc = dataContainer.querySelector('.data-img-pc').innerText;
    const imgMobile = dataContainer.querySelector('.data-img-mobile').innerText;

    // Set Data
    document.getElementById('modal-title').innerText = title;
    document.getElementById('modal-desc').innerText = desc;
    document.getElementById('modal-category').innerText = category || 'TEMPLATE';
    
    // Set Images
    const pcImgElem = document.getElementById('modal-img-pc');
    const pcNoImg = document.getElementById('no-img-pc');
    if(imgPc && imgPc.trim() !== "") {
      pcImgElem.src = imgPc;
      pcImgElem.style.display = 'block';
      pcNoImg.style.display = 'none';
    } else {
      pcImgElem.style.display = 'none';
      pcNoImg.style.display = 'block';
    }

    const moImgElem = document.getElementById('modal-img-mobile');
    const moNoImg = document.getElementById('no-img-mobile');
    if(imgMobile && imgMobile.trim() !== "") {
      moImgElem.src = imgMobile;
      moImgElem.style.display = 'block';
      moNoImg.style.display = 'none';
    } else {
      moImgElem.style.display = 'none';
      moNoImg.style.display = 'block';
    }

    // Set PICK Link
    document.getElementById('btn-pick').href = "/contact?template_id=" + id + "&template_title=" + encodeURIComponent(title);

    // Reset View to PC
    switchView('pc');

    // Show Modal
    modal.style.display = 'block';
    setTimeout(() => {
      modal.style.opacity = '1';
      content.style.transform = 'translate(-50%, -50%) scale(1)';
    }, 10);
    document.body.style.overflow = 'hidden';
  }

  function closeTemplateModal() {
    const modal = document.getElementById('template-modal');
    const content = modal.querySelector('.modal-content');
    
    modal.style.opacity = '0';
    content.style.transform = 'translate(-50%, -50%) scale(0.95)';
    
    setTimeout(() => {
      modal.style.display = 'none';
      document.body.style.overflow = '';
    }, 300);
  }

  function switchView(mode) {
    const viewPc = document.getElementById('view-pc');
    const viewMobile = document.getElementById('view-mobile');
    const btnPc = document.getElementById('btn-view-pc');
    const btnMobile = document.getElementById('btn-view-mobile');

    if (mode === 'pc') {
      viewPc.style.display = 'block';
      viewMobile.style.display = 'none';
      btnPc.classList.add('active');
      btnMobile.classList.remove('active');
    } else {
      viewPc.style.display = 'none';
      viewMobile.style.display = 'block';
      btnPc.classList.remove('active');
      btnMobile.classList.add('active');
    }
  }
</script>
