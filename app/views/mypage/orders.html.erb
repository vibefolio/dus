<% content_for :title, "주문 내역 - 디어스" %>

<div class="min-h-screen bg-gray-50 py-12">
  <div class="container mx-auto px-4 max-w-6xl">
    <!-- 헤더 -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">주문 내역</h1>
      <p class="text-gray-600">구매하신 템플릿과 서비스를 확인하세요</p>
    </div>

    <!-- 탭 메뉴 -->
    <div class="bg-white rounded-2xl shadow-sm mb-8">
      <div class="flex border-b border-gray-200">
        <%= link_to mypage_path, class: "flex-1 px-6 py-4 text-center font-medium text-gray-600 hover:text-emerald-600 transition" do %>
          <span>대시보드</span>
        <% end %>
        <%= link_to mypage_orders_path, class: "flex-1 px-6 py-4 text-center font-medium border-b-2 border-emerald-600 text-emerald-600" do %>
          <span>주문 내역</span>
        <% end %>
        <%= link_to mypage_wishlist_path, class: "flex-1 px-6 py-4 text-center font-medium text-gray-600 hover:text-emerald-600 transition" do %>
          <span>위시리스트</span>
        <% end %>
      </div>
    </div>

    <% if @orders.any? %>
      <!-- 주문 목록 -->
      <div class="space-y-4">
        <% @orders.each do |order| %>
          <div class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition">
            <!-- 주문 헤더 -->
            <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                  <div>
                    <div class="text-sm text-gray-600">주문번호</div>
                    <div class="font-bold text-gray-900">#<%= order.id %></div>
                  </div>
                  <div class="h-8 w-px bg-gray-300"></div>
                  <div>
                    <div class="text-sm text-gray-600">주문일자</div>
                    <div class="font-medium text-gray-900"><%= order.created_at.strftime('%Y년 %m월 %d일') %></div>
                  </div>
                </div>
                <span class="px-4 py-2 bg-emerald-100 text-emerald-700 text-sm font-medium rounded-full">
                  <%= order.status || '완료' %>
                </span>
              </div>
            </div>

            <!-- 주문 상세 -->
            <div class="p-6">
              <% if order.order_items&.any? %>
                <div class="space-y-4 mb-6">
                  <% order.order_items.each do |item| %>
                    <div class="flex items-center gap-4">
                      <% if item.design_template&.thumbnail_url.present? %>
                        <%= image_tag item.design_template.thumbnail_url, class: "w-20 h-20 rounded-lg object-cover" %>
                      <% else %>
                        <div class="w-20 h-20 rounded-lg bg-gradient-to-br from-emerald-100 to-emerald-200"></div>
                      <% end %>
                      <div class="flex-1">
                        <div class="font-medium text-gray-900"><%= item.design_template&.name || '템플릿' %></div>
                        <div class="text-sm text-gray-600">수량: <%= item.quantity %></div>
                      </div>
                      <div class="text-right">
                        <div class="font-bold text-gray-900">
                          <%= number_to_currency(item.price * item.quantity, unit: '₩', precision: 0) %>
                        </div>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% end %>

              <!-- 총액 -->
              <div class="border-t border-gray-200 pt-4">
                <div class="flex items-center justify-between text-lg">
                  <span class="font-medium text-gray-900">총 결제금액</span>
                  <span class="font-bold text-emerald-600 text-2xl">
                    <%= number_to_currency(order.total_amount || 0, unit: '₩', precision: 0) %>
                  </span>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <!-- 빈 상태 -->
      <div class="bg-white rounded-2xl shadow-sm p-16 text-center">
        <svg class="w-24 h-24 mx-auto mb-6 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
        </svg>
        <h2 class="text-2xl font-bold text-gray-900 mb-2">주문 내역이 없습니다</h2>
        <p class="text-gray-600 mb-8">첫 번째 템플릿을 구매해보세요</p>
        <%= link_to "템플릿 둘러보기", design_templates_path, class: "inline-flex items-center gap-2 px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition font-medium" %>
      </div>
    <% end %>
  </div>
</div>
