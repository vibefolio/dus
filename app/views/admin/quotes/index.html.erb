<div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: var(--space-8); flex-wrap: wrap; gap: var(--space-4);">
  <div>
    <h1 style="font-size: var(--text-4xl); margin-bottom: var(--space-2);">문의 내역 관리</h1>
    <p class="text-gray">고객으로부터 접수된 프로젝트 문의를 확인하고 관리하세요</p>
  </div>

  <div style="flex: 1; max-width: 600px;">
    <%= form_with url: admin_quotes_path, method: :get, class: "flex gap-2 items-center", local: true do |f| %>
      <%= f.select :status, [["모든 상태", ""]] + [["대기중", "pending"], ["처리완료", "completed"]], { selected: params[:status] }, class: "block rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm p-2 bg-white border" %>
      <%= f.text_field :query, value: params[:query], placeholder: "이름, 회사, 이메일 검색", class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 sm:text-sm p-2 bg-white border" %>
      <%= f.submit "검색", class: "btn btn-primary" %>
      <% if params[:query].present? || params[:status].present? %>
        <%= link_to "초기화", admin_quotes_path, class: "btn btn-outline" %>
      <% end %>
    <% end %>
  </div>
</div>

<% if @quotes.any? %>
<%= form_tag bulk_destroy_admin_quotes_path, method: :delete, id: "bulk-delete-form" do %>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-4);">
    <div style="display: flex; gap: var(--space-4); align-items: center;">
      <label style="display: flex; align-items: center; gap: var(--space-2); cursor: pointer;">
        <input type="checkbox" id="select-all-quotes" style="width: 16px; height: 16px;">
        <span style="font-size: var(--text-sm); font-weight: 600;">전체 선택</span>
      </label>
      <button type="submit" class="btn btn-sm btn-danger" id="bulk-delete-btn" disabled 
              data-confirm="선택한 문의 내역을 정말 삭제하시겠습니까?">
        선택 삭제
      </button>
    </div>
  </div>

  <div class="grid grid-2" style="gap: var(--space-6);">
    <% @quotes.each do |quote| %>
      <div class="card quote-card" style="position: relative;">
        <!-- Checkbox Overlay -->
        <div style="position: absolute; top: var(--space-4); left: var(--space-4); z-index: 10;">
          <input type="checkbox" name="quote_ids[]" value="<%= quote.id %>" class="quote-checkbox" style="width: 18px; height: 18px; cursor: pointer;">
        </div>

        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: var(--space-4); padding-left: var(--space-8);">
          <div>
            <h3 style="font-size: var(--text-xl); font-weight: 700; margin-bottom: var(--space-2);">
              <%= quote.contact_name %>
            </h3>
            <% if quote.company_name.present? %>
              <p style="color: var(--color-gray-600); font-size: var(--text-sm);">
                <%= quote.company_name %>
              </p>
            <% end %>
          </div>
          <span style="display: inline-block; padding: var(--space-1) var(--space-3); background: <%= quote.status == 'pending' ? 'var(--color-warning)' : 'var(--color-success)' %>; color: white; border-radius: var(--radius-full); font-size: var(--text-xs); font-weight: 600;">
            <%= quote.status == 'pending' ? '대기중' : '처리완료' %>
          </span>
        </div>

        <div style="margin-bottom: var(--space-4); padding-left: var(--space-8);">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-3); margin-bottom: var(--space-3);">
            <div>
              <p style="font-size: var(--text-xs); color: var(--color-gray-500); margin-bottom: var(--space-1);">이메일</p>
              <p style="font-size: var(--text-sm); color: var(--color-gray-700);"><%= quote.email %></p>
            </div>
            <div>
              <p style="font-size: var(--text-xs); color: var(--color-gray-500); margin-bottom: var(--space-1);">연락처</p>
              <p style="font-size: var(--text-sm); color: var(--color-gray-700);"><%= quote.phone %></p>
            </div>
          </div>

          <% if quote.project_type.present? %>
            <div style="margin-bottom: var(--space-3);">
              <p style="font-size: var(--text-xs); color: var(--color-gray-500); margin-bottom: var(--space-1);">프로젝트 유형</p>
              <span style="display: inline-block; padding: var(--space-1) var(--space-3); background: var(--color-accent); color: white; border-radius: var(--radius-full); font-size: var(--text-sm); font-weight: 600;">
                <%= quote.project_type %>
              </span>
            </div>
          <% end %>

          <% if quote.budget.present? %>
            <div style="margin-bottom: var(--space-3);">
              <p style="font-size: var(--text-xs); color: var(--color-gray-500); margin-bottom: var(--space-1);">예산 범위</p>
              <p style="font-size: var(--text-sm); color: var(--color-gray-700);"><%= quote.budget %></p>
            </div>
          <% end %>

          <% if quote.message.present? %>
            <div>
              <p style="font-size: var(--text-xs); color: var(--color-gray-500); margin-bottom: var(--space-1);">문의 내용</p>
              <p style="font-size: var(--text-sm); color: var(--color-gray-700); line-height: 1.6;">
                <%= truncate(quote.message, length: 150) %>
              </p>
            </div>
          <% end %>
        </div>

        <div style="padding-top: var(--space-4); border-top: 1px solid var(--color-gray-200); display: flex; justify-content: space-between; align-items: center; padding-left: var(--space-8);">
          <p style="font-size: var(--text-xs); color: var(--color-gray-500);">
            <%= quote.created_at.strftime("%Y-%m-%d %H:%M") %>
          </p>
          <div class="flex gap-2">
            <%= link_to "삭제", admin_quote_path(quote), data: { turbo_method: :delete, turbo_confirm: "정말 삭제하시겠습니까?" }, class: "btn btn-sm btn-danger" %>
            <%= link_to "상세보기", admin_quote_path(quote), class: "btn btn-sm btn-primary" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% end %>

<div style="margin-top: var(--space-8); display: flex; justify-content: center;">
  <%= paginate @quotes rescue nil %>
</div>

<script>
  document.addEventListener('turbo:load', function() {
    const selectAll = document.getElementById('select-all-quotes');
    const checkboxes = document.querySelectorAll('.quote-checkbox');
    const deleteBtn = document.getElementById('bulk-delete-btn');

    function updateDeleteButton() {
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      deleteBtn.disabled = !anyChecked;
    }

    if (selectAll) {
      selectAll.addEventListener('change', function() {
        checkboxes.forEach(cb => cb.checked = selectAll.checked);
        updateDeleteButton();
      });
    }

    checkboxes.forEach(cb => {
      cb.addEventListener('change', updateDeleteButton);
    });
  });
</script>
<% else %>
  <div class="card text-center" style="padding: var(--space-20);">
    <div style="width: 100px; height: 100px; background: var(--color-gray-100); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; margin: 0 auto var(--space-6);">
      <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="var(--color-gray-400)" stroke-width="2">
        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
        <polyline points="22,6 12,13 2,6"/>
      </svg>
    </div>
    <h3 style="font-size: var(--text-2xl); margin-bottom: var(--space-4);">접수된 문의가 없습니다</h3>
    <p class="text-gray">고객의 문의가 접수되면 여기에 표시됩니다</p>
  </div>
<% end %>
