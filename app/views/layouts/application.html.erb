<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8">
    <title><%= content_for(:title) || "디어스 - AI와 함께하는 디지털 혁신 파트너" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="description" content="<%= content_for(:description) || '디어스는 AI 기술과 창의적인 디자인으로 비즈니스의 성공을 이끄는 프리미엄 개발 에이전시입니다.' %>">
    <meta name="keywords" content="웹개발, 앱개발, AI개발, UI/UX디자인, 개발에이전시, 디어스, D.US, 홈페이지제작, 랜딩페이지">
    <meta name="author" content="디어스">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#00a859">
    
    <!-- Performance Hints -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://images.unsplash.com">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="<%= request.original_url %>">
    <meta property="og:title" content="<%= content_for?(:title) ? "#{content_for(:title)} | DLAB" : "DLAB - AI Premium Web Agency" %>">
    <meta property="og:description" content="<%= content_for?(:description) ? content_for(:description) : "AI 기술과 디자인의 완벽한 조화. 디랩에서 당신의 비즈니스를 혁신하세요." %>">
    <meta property="og:image" content="<%= content_for?(:og_image) ? content_for(:og_image) : asset_path('logo.png') %>">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="<%= request.original_url %>">
    <meta name="twitter:title" content="<%= content_for?(:title) ? "#{content_for(:title)} | DLAB" : "DLAB - AI Premium Web Agency" %>">
    <meta name="twitter:description" content="<%= content_for?(:description) ? content_for(:description) : "AI 기술과 디자인의 완벽한 조화. 디랩에서 당신의 비즈니스를 혁신하세요." %>">
    <meta name="twitter:image" content="<%= content_for?(:og_image) ? content_for(:og_image) : asset_path('logo.png') %>">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="디어스">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/favicon.png" type="image/png">
    <link rel="apple-touch-icon" href="/favicon.png">

    <!-- Fonts (Optimized) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" as="style" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css"></noscript>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">  
    
    <!-- Critical CSS - Prevent FOUC (Flash of Unstyled Content) -->
    <style>
      /* Critical Layout Styles - Inline for instant render */
      *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
      html { font-family: 'Pretendard', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.5; }
      body { min-height: 100vh; background-color: #fff; color: #1f2937; }
      .navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 1rem 2rem; }
      .navbar-container { display: flex; align-items: center; justify-content: space-between; max-width: 1280px; margin: 0 auto; }
      .navbar-menu { display: flex; gap: 2rem; list-style: none; }
      .navbar-link { text-decoration: none; color: #374151; font-weight: 500; }
      .container { max-width: 1280px; margin: 0 auto; padding: 0 1rem; }
      main { padding-top: 80px; }
      img { max-width: 100%; height: auto; }
      /* Flexbox utilities */
      .flex { display: flex; }
      .items-center { align-items: center; }
      .justify-between { justify-content: space-between; }
      /* Mobile menu hidden by default - will be controlled by Tailwind */
    </style>

    <!-- Tailwind CSS CDN (No defer - load immediately) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                DEFAULT: "#00a859",
                dark: "#008a47",
              },
              accent: "#00d670",
            },
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              serif: ["Noto Serif KR", "serif"],
              cinzel: ["Cinzel", "serif"],
            }
          }
        }
      }
    </script>

    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  </head>

  <body>
    <!-- Navigation -->
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
      <div class="navbar-container">
        <%= link_to root_path, class: "navbar-logo" do %>
          <%= image_tag "logo.png", alt: "디어스", style: "height: 50px; width: auto;" %>
        <% end %>
        
        <!-- Desktop Menu -->
        <ul class="navbar-menu hidden md:flex">
          <li><%= link_to "홈", root_path, class: "navbar-link #{current_page?(root_path) ? 'active' : ''}" %></li>
          <li><%= link_to "디자인 템플릿", design_templates_path, class: "navbar-link #{current_page?(design_templates_path) ? 'active' : ''}" %></li>
          <%# <li><%= link_to "포트폴리오", portfolio_path, class: "navbar-link #{current_page?(portfolio_path) ? 'active' : ''}" %>
          <li><%= link_to "구독요금제", pricing_path, class: "navbar-link #{current_page?(pricing_path) ? 'active' : ''}" %></li>
          <li><%= link_to "문의하기", contact_path, class: "navbar-link #{current_page?(contact_path) ? 'active' : ''}" %></li>
        </ul>

        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-600 hover:text-emerald-600 focus:outline-none">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <!-- Mobile Menu Dropdown -->
      <div id="mobile-menu" class="hidden md:hidden absolute top-full left-0 w-full bg-white shadow-lg border-t border-gray-100 flex flex-col p-4 space-y-4">
        <%= link_to "홈", root_path, class: "block px-4 py-2 text-gray-700 font-bold hover:bg-gray-50 rounded-lg #{current_page?(root_path) ? 'text-emerald-600 bg-emerald-50' : ''}" %>
        <%= link_to "디자인 템플릿", design_templates_path, class: "block px-4 py-2 text-gray-700 font-bold hover:bg-gray-50 rounded-lg #{current_page?(design_templates_path) ? 'text-emerald-600 bg-emerald-50' : ''}" %>
        <%= link_to "구독요금제", pricing_path, class: "block px-4 py-2 text-gray-700 font-bold hover:bg-gray-50 rounded-lg #{current_page?(pricing_path) ? 'text-emerald-600 bg-emerald-50' : ''}" %>
        <%= link_to "문의하기", contact_path, class: "block px-4 py-2 text-gray-700 font-bold hover:bg-gray-50 rounded-lg #{current_page?(contact_path) ? 'text-emerald-600 bg-emerald-50' : ''}" %>
      </div>
    </nav>
    
    <script>
      // Mobile Menu Toggle
      const mobileBtn = document.getElementById('mobile-menu-btn');
      const mobileMenu = document.getElementById('mobile-menu');

      if (mobileBtn && mobileMenu) {
        mobileBtn.addEventListener('click', () => {
          mobileMenu.classList.toggle('hidden');
        });
      }
    </script>

    <!-- Flash Messages (Toast) -->
    <div class="fixed top-24 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-lg px-4 space-y-2 pointer-events-none">
      <% flash.each do |key, value| %>
        <div class="flash-message pointer-events-auto shadow-lg rounded-lg p-4 flex items-center justify-between text-white transition-all duration-300 ease-in-out transform translate-y-0 opacity-100 <%= key == 'notice' ? 'bg-emerald-600' : 'bg-red-500' %>">
          <div class="flex items-center gap-3">
             <% if key == 'notice' %>
               <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
             <% else %>
               <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
             <% end %>
             <span class="font-medium"><%= value %></span>
          </div>
          <button onclick="this.parentElement.remove()" class="text-white hover:text-gray-200 focus:outline-none">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
          </button>
        </div>
      <% end %>
    </div>

    <!-- Main Content -->
    <main>
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>디어스</h3>
            <p>앱/웹 개발과 유지보수의<br>새로운 기준을 제시합니다</p>
          </div>
          
          <div class="footer-section">
            <h3>서비스</h3>
            <ul>
              <li><a href="#">웹 개발</a></li>
              <li><a href="#">앱 개발</a></li>
              <li><a href="#">UI/UX 디자인</a></li>
              <li><a href="#">디지털 마케팅</a></li>
            </ul>
          </div>
          
          <div class="footer-section">
            <h3>회사</h3>
            <ul>
              <li><%= link_to "디자인 템플릿", design_templates_path %></li>
              <li><%= link_to "구독요금제", pricing_path %></li>
              <li><%= link_to "문의하기", contact_path %></li>
            </ul>
          </div>
          
          <div class="footer-section">
            <h3>연락처</h3>
            <p>이메일: duscontactus@gmail.com</p>
          </div>
        </div>
        
        <div class="footer-bottom">
          <p>&copy; <%= Time.current.year %> 디어스(D.US). All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- Scroll to Top Button -->
    <button id="scrollToTopBtn" class="fixed bottom-8 right-8 z-50 bg-emerald-600 hover:bg-emerald-700 text-white p-3 rounded-full shadow-lg transition-all transform translate-y-20 opacity-0" onclick="scrollToTop()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 15l-6-6-6 6"/>
      </svg>
    </button>

    <!-- Navbar & Utility Scripts -->
    <!-- Floating Consultation Button -->
    <a href="<%= contact_path %>" class="fixed bottom-24 right-8 z-50 bg-white text-emerald-600 p-4 rounded-full shadow-xl hover:shadow-2xl transition-all transform hover:scale-105 flex items-center justify-center group" title="실시간 문의">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
      <span class="absolute right-full mr-3 bg-gray-900 text-white text-sm py-1 px-3 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
        무료 견적 문의
      </span>
    </a>

    <script>
      function initializeUI() {
        // 1. Scroll Animations (Intersection Observer)
        const observerOptions = {
          root: null,
          rootMargin: '0px',
          threshold: 0.1
        };

        const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.style.animationPlayState = 'running';
              entry.target.style.opacity = '1';
              entry.target.style.transform = 'translateY(0)';
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        document.querySelectorAll('.fade-in-section').forEach(section => {
          section.style.opacity = '0';
          section.style.transform = 'translateY(20px)';
          section.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
          observer.observe(section);
        });

        // 2. Auto-hide Flash Messages (Toast)
        const flashes = document.querySelectorAll('.flash-message');
        flashes.forEach(flash => {
          setTimeout(() => {
            flash.style.opacity = '0';
            flash.style.transform = 'translateY(-20px)';
            setTimeout(() => {
              flash.remove();
            }, 300);
          }, 4000); 
        });

        // 3. Client-side Form Validation
        const contactForm = document.querySelector('form[action="/contact"]');
        if (contactForm) {
          // Remove existing listeners to prevent duplicates if any
          const newForm = contactForm.cloneNode(true);
          contactForm.parentNode.replaceChild(newForm, contactForm);
          
          newForm.addEventListener('submit', function(event) {
            let isValid = true;
            const emailInput = newForm.querySelector('input[type="email"]');
            const phoneInput = newForm.querySelector('input[name="quote[phone]"]');
            
            if (emailInput && !emailInput.value.includes('@')) {
              isValid = false;
              alert('올바른 이메일 주소를 입력해주세요.');
              emailInput.focus();
              event.preventDefault();
              return;
            }
             
            if (phoneInput && phoneInput.value.length < 9) {
              isValid = false;
              alert('올바른 전화번호를 입력해주세요.');
              phoneInput.focus();
              event.preventDefault();
              return;
            }
          });
        }
      }

      // Navbar Scroll Effect (Global Listener)
      window.addEventListener('scroll', function() {
        const navbar = document.getElementById('navbar');
        const scrollBtn = document.getElementById('scrollToTopBtn');
        
        if (navbar) {
          if (window.scrollY > 50) {
            navbar.classList.add('scrolled');
          } else {
            navbar.classList.remove('scrolled');
          }
        }

        if (scrollBtn) {
          if (window.scrollY > 300) {
            scrollBtn.classList.remove('translate-y-20', 'opacity-0');
          } else {
            scrollBtn.classList.add('translate-y-20', 'opacity-0');
          }
        }
      });

      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      // Initialize on load and Turbo navigation
      document.addEventListener('turbo:load', initializeUI);
      document.addEventListener('DOMContentLoaded', initializeUI);
    </script>
  </body>
</html>
